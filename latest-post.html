<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Latest Moroccan Tape Stash Post</title>

<style>
body {
  font-family: Helvetica, Arial, sans-serif;
  margin: 0;
  padding: 0;
}

#card {
  border: 1px solid #ddd;
  padding: 14px;
  max-width: 100%;
}

img {
  max-width: 100%;
  height: auto;
  display: block;
  margin-bottom: 12px;
}

h3 {
  font-size: 1.1rem;
  font-weight: normal;
  margin: 0 0 8px 0;
}

h3 a {
  color: inherit;
  text-decoration: none;
}

h3 a:hover {
  text-decoration: underline;
}

.date {
  font-size: 0.75rem;
  color: #666;
  margin-bottom: 10px;
}

p {
  font-size: 0.95rem;
  line-height: 1.4;
  margin: 0;
}
</style>
</head>

<body>

<div id="card">Loading latest post…</div>

<script>
function show(feed) {
  if (!feed.feed || !feed.feed.entry || !feed.feed.entry.length) {
    document.getElementById("card").textContent = "No posts found.";
    return;
  }

  const post = feed.feed.entry[0];
  const contentHTML = post.content.$t;

  // Post URL
  const link = post.link.find(l => l.rel === "alternate").href;

  // Date formatting
  const rawDate = post.published.$t;
  const dateObj = new Date(rawDate);
  const dateStr = dateObj.toLocaleDateString(undefined, {
    year: "numeric",
    month: "short",
    day: "numeric"
  });

  const doc = new DOMParser().parseFromString(contentHTML, "text/html");

  // First image
  const img = doc.querySelector("img");

  // Remove images before text extraction
  doc.querySelectorAll("img").forEach(img => img.remove());

  // Find first meaningful text
  let firstText = "";
  const candidates = doc.body.querySelectorAll("p, div, span");

  for (const el of candidates) {
    const text = el.textContent.replace(/\s+/g, " ").trim();
    if (text.length > 40) {
      firstText = text;
      break;
    }
  }

  // Trim text length
  if (firstText.length > 220) {
    firstText = firstText.slice(0, 220).trim() + "…";
  }

  // Detect text direction (RTL/LTR)
  const isRTL = /[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]/.test(firstText);
  const dir = isRTL ? "rtl" : "ltr";

  document.getElementById("card").innerHTML = `
    ${img ? `<img src="${img.src}" alt="">` : ""}
    <h3><a href="${link}" target="_blank" rel="noopener">${post.title.$t}</a></h3>
    <div class="date">${dateStr}</div>
    <p dir="${dir}">${firstText}</p>
  `;
}
</script>

<script src="https://moroccantapestash.blogspot.com/feeds/posts/default?alt=json-in-script&max-results=1&callback=show"></script>

</body>
</html>
